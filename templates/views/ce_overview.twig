{% extends 'layout.twig' %}

{% set module = 'Competition Explorer' %}

{% block content %}
{% include 'slots/back-to-dashboard.twig' %}
<div
    ng-controller="ce"
    data-categories="{{ categories|json_encode()|e('html') }}"
    data-sections="{{ sections|json_encode()|e('html') }}"
    data-url="{{ url('ce_xhr') }}"
    >
    <div class="row-fluid">
        <div class="span12">
            <div class="page-header">
                <h1>
                    {{ module }}
                </h1>
            </div>
            <form class="form-horizontal" name="form" ng-submit="process()">
                <div class="control-group">
                    <label class="control-label" for="category">
                        Category
                    </label>
                    <div class="controls">
                        <select
                            class="select2 span12"
                            id="category"
                            ng-model="category"
                            ng-options="category[0] as category[1] for category in categories"
                            ></select>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="section">Section</label>
                    <div class="controls">
                        <select
                            class="select2 span12"
                            id="section"
                            ng-model="section"
                            ng-options="section[0] as section[1] for section in sections"
                            ></select>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="pages">Pages</label>
                    <div class="controls">
                        <select
                            class="select2 span12"
                            id="pages"
                            ng-model="page_1"
                            ng-options="page_1 as page_1 for page_1 in pages_1"
                            ></select>
                        <input
                            class="span12"
                            max="10000"
                            min="1"
                            ng-model="page_2"
                            ng-show="page_1 != 'Any'"
                            type="number"
                            >
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="count">Top</label>
                    <div class="controls">
                        <select
                            class="select2 span12"
                            id="count"
                            ng-model="count"
                            ng-options="count as count for count in counts"
                            ></select>
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn btn-success" type="submit">
                        <span class="icon-info-sign icon-large"></span>
                        Submit
                    </button>
                    <button class="btn btn-danger" type="reset">
                        <span class="icon-trash icon-large"></span>
                        Reset
                    </button>
                </div>
            </form>
            <p class="text-center hide [! spinner == true && 'show' || 'hide' !]">
                <span class="icon-spinner icon-spin icon-2x"></span>
            </p>
            <p class="alert alert-error" ng-show="error">
                Your query did not yield any results.
            </p>
            <div ng-show="contents.date_and_time.length || contents.books.length || contents.reviews.length || contents.categories.length || contents.referrals.length">
                <div ng-show="contents.date_and_time.length">
                    <p class="text-center">
                        This section was last updated on
                        <strong>[! contents.date_and_time !].</strong>
                    </p>
                </div>
                <div ng-show="contents.books.length">
                    <hr>
                    <div class="page-header">
                        <h2>Books</h2>
                    </div>
                    <div
                        class="row-fluid"
                        ng-repeat="batch in contents.books"
                        >
                        <div
                            class="span4"
                            ng-repeat="book in batch"
                            >
                            <div class="media well">
                                <div class="media-body">
                                    <h4 class="media-heading">
                                        [! book.rank !].
                                        <a
                                            href="[! book.url !]"
                                            rel="nofollow"
                                            target="_blank"
                                            >[! book.title !]</a>
                                    </h4>
                                    <p>
                                        <strong>Author:</strong>
                                        [! book.author !]
                                    </p>
                                    <p>
                                        <strong>Price:</strong>
                                        $[! book.price|number:2 !]
                                    </p>
                                    <p>
                                        <strong>Publication Date:</strong>
                                        [! book.publication_date !]
                                    </p>
                                    <p>
                                        <strong>Print Length:</strong>
                                        [! book.print_length|number:0 !]
                                    </p>
                                    <p><strong>Categories & Ranks:</strong></p>
                                    <ul>
                                        <li ng-repeat="(key, value) in book.amazon_best_sellers_rank">
                                            <strong>#[! value !]</strong>
                                            in
                                            [! key !]
                                        </li>
                                    </ul>
                                    <p>
                                        <strong>
                                            Estimated Sales Per Day:
                                        </strong>
                                        [! book.estimated_sales_per_day|number:0 !]
                                    </p>
                                    <p>
                                        <strong>Earnings Per Day:</strong>
                                        $[! book.earnings_per_day|number:2 !]
                                    </p>
                                    <p>
                                        <strong>Reviews:</strong>
                                        [! book.total_number_of_reviews|number:0 !]
                                    </p>
                                    <p>
                                        <strong>Review Avg:</strong>
                                        [! book.review_average|number:2 !]
                                    </p>
                                    <p><strong>Appearances:</strong></p>
                                    <ul>
                                        <li ng-repeat="(key, value) in book.appearances">
                                            <strong>
                                                [! value|number:2 !]%
                                            </strong>
                                            in the
                                            [! key !]
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div ng-show="contents.reviews.length">
                    <hr>
                    <div class="page-header">
                        <h2>Worst Reviews</h2>
                    </div>
                    <div ng-repeat="review in contents.reviews">
                        <div class="media well">
                            <div class="media-body">
                                <h4 class="media-heading">
                                    [! review.author !]
                                    <span class="pull-right">
                                        [! review.stars|number:2 !] stars
                                    </span>
                                </h4>
                                <p>
                                    <span class="pull-right">
                                        [! review.date !]
                                    </span>
                                    <strong>[! review.subject !]</strong>
                                </p>
                                <p>[! review.body !]</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div ng-show="contents.categories.length">
                    <hr>
                    <div class="page-header">
                        <h2>Best Categories</h2>
                    </div>
                    <table class="table table-hover table-striped">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th class="narrow text-right">Frequency</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="category in contents.categories">
                                <td><strong>[! category[0] !]</strong></td>
                                <td class="narrow text-right">
                                    [! category[1]|number:0 !]
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div ng-show="contents.referrals.length">
                    <hr>
                    <div class="page-header">
                        <h2>Referrals</h2>
                    </div>
                    <p>
                        We scan the "customers who purchased this also
                        bought..." section of each book to find products which
                        appear in multiple listings and then display them here.
                        Customers that purchased the top products in this
                        category also bought these, look into what makes them
                        attractive and use that information to your advantage.
                    </p>
                    <table class="table table-hover table-striped">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Author</th>
                                <th class="narrow text-right">
                                    Price (in $)
                                </th>
                                <th class="narrow text-right">Reviews</th>
                                <th class="narrow text-right">
                                    Review Average
                                </th>
                                <th class="narrow text-right">Frequency</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="referral in contents.referrals">
                                <td>
                                    <a
                                        href="[! referral.url !]"
                                        rel="nofollow"
                                        target="_blank"
                                        >[! referral.title !]</a>
                                </td>
                                <td>[! referral.author !]</td>
                                <td class="narrow text-right">
                                    [! referral.price|number:2 !]
                                </td>
                                <td class="narrow text-right">
                                    [! referral.total_number_of_reviews|number:0 !]
                                </td>
                                <td class="narrow text-right">
                                    [! referral.review_average|number:2 !]
                                </td>
                                <td class="narrow text-right">
                                    [! referral.count|number:0 !]
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
