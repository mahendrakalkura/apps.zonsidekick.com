{% extends 'layout.twig' %}

{% set module = 'Top 100 Explorer' %}

{% block content %}
{% include 'slots/back-to-dashboard.twig' %}
<div
    ng-controller="ce"
    data-categories="{{ categories|json_encode()|e('html') }}"
    data-sections="{{ sections|json_encode()|e('html') }}"
    data-url="{{ url('ce_xhr') }}"
    >
    <div class="row-fluid">
        <div class="span12">
            <div class="page-header">
                <h1>
                    {{ module }}
                </h1>
            </div>
            <form class="form-horizontal" name="form" ng-submit="process()">
                <div class="row-fluid">
                    <div class="span12">
                        <div class="control-group">
                            <label class="control-label" for="category">
                                Category
                            </label>
                            <div class="controls">
                                <select
                                    class="select2 span12"
                                    id="category"
                                    ng-model="category"
                                    ng-options="category[0] as category[1] for category in categories"
                                    ></select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span4">
                        <div class="control-group">
                            <label class="control-label" for="section">
                                Section
                            </label>
                            <div class="controls">
                                <select
                                    class="select2 span12"
                                    id="section"
                                    ng-model="section"
                                    ng-options="section[0] as section[1] for section in sections"
                                    ></select>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="count">
                                Top
                            </label>
                            <div class="controls">
                                <select
                                    class="select2 span12"
                                    id="count"
                                    ng-model="count"
                                    ng-options="count as count for count in counts"
                                    ></select>
                            </div>
                        </div>
                    </div>
                    <div class="span4">
                        <div class="control-group">
                            <label class="control-label" for="print_length">
                                Print Length
                            </label>
                            <div class="controls">
                                <select
                                    class="select2 span12"
                                    id="print_length"
                                    ng-model="print_length_1"
                                    ng-options="print_length as print_length for print_length in print_lengths"
                                    ></select>
                                <input
                                    class="span12"
                                    max="999999999"
                                    min="0"
                                    ng-model="print_length_2"
                                    ng-show="print_length_1 != 'Any'"
                                    type="number"
                                    >
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="price">
                                Price
                            </label>
                            <div class="controls">
                                <select
                                    class="select2 span12"
                                    id="prices"
                                    ng-model="price_1"
                                    ng-options="price as price for price in prices"
                                    ></select>
                                <input
                                    class="span12"
                                    max="999999999"
                                    min="0"
                                    ng-model="price_2"
                                    ng-show="price_1 != 'Any'"
                                    step="any"
                                    type="number"
                                    >
                            </div>
                        </div>
                        <div class="control-group">
                            <label
                                class="control-label"
                                for="publication_date"
                                >Publication Date</label>
                            <div class="controls">
                                <select
                                    class="select2 span12"
                                    id="publication_dates"
                                    ng-model="publication_date_1"
                                    ng-options="publication_date as publication_date for publication_date in publication_dates"
                                    ></select>
                                <div
                                    class="date input-append span12"
                                    datepicker
                                    ng-show="publication_date_1 != 'Any'"
                                    >
                                    <input class="span12" type="text">
                                    <span class="add-on">
                                        <i class="icon-calendar"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="span4">
                        <div class="control-group">
                            <label
                                class="control-label"
                                for="amazon_best_sellers_rank"
                                >Amazon BSR</label>
                            <div class="controls">
                                <select
                                    class="select2 span12"
                                    id="amazon_best_sellers_ranks"
                                    ng-model="amazon_best_sellers_rank_1"
                                    ng-options="amazon_best_sellers_rank as amazon_best_sellers_rank for amazon_best_sellers_rank in amazon_best_sellers_ranks"
                                    ></select>
                                <input
                                    class="span12"
                                    max="999999999"
                                    min="0"
                                    ng-model="amazon_best_sellers_rank_2"
                                    ng-show="amazon_best_sellers_rank_1 != 'Any'"
                                    type="number"
                                    >
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="review_average">
                                Review Average
                            </label>
                            <div class="controls">
                                <select
                                    class="select2 span12"
                                    id="review_averages"
                                    ng-model="review_average_1"
                                    ng-options="review_average as review_average for review_average in review_averages"
                                    ></select>
                                <input
                                    class="span12"
                                    max="5.0"
                                    min="0.0"
                                    ng-model="review_average_2"
                                    ng-show="review_average_1 != 'Any'"
                                    step="any"
                                    type="number"
                                    >
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="appearance">
                                Prevalence
                            </label>
                            <div class="controls">
                                <select
                                    class="select2 span12"
                                    id="appearances"
                                    ng-model="appearance_1"
                                    ng-options="appearance as appearance for appearance in appearances"
                                    ></select>
                                <input
                                    class="span12"
                                    max="100"
                                    min="0"
                                    ng-model="appearance_2"
                                    ng-show="appearance_1 != 'Any'"
                                    step="any"
                                    type="number"
                                    >
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ce form-actions">
                    <button class="btn btn-danger pull-left" type="reset">
                        <span class="icon-trash icon-large"></span>
                        Reset
                    </button>
                    <button class="btn btn-success pull-right" type="submit">
                        <span class="icon-info-sign icon-large"></span>
                        Submit
                    </button>
                </div>
            </form>
            <p class="text-center hide [! spinner == true && 'show' || 'hide' !]">
                <span class="icon-spinner icon-spin icon-2x"></span>
            </p>
            <p class="alert alert-error" ng-show="error">
                Your query did not yield any results.
            </p>
            <div ng-show="contents.date.length || contents.books.length || contents.categories.length">
                <div ng-show="contents.date.length">
                    <p class="text-center">
                        This section was last updated on
                        <strong>[! contents.date !].</strong>
                    </p>
                </div>
                <div ng-show="contents.books.length">
                    <hr>
                    <div class="page-header">
                        <div
                            class="btn-group pull-right"
                            data-toggle="buttons-radio"
                            >
                            <button
                                class="btn btn-default"
                                ng-class="mode == 'table' && 'active' || ''"
                                ng-click="mode = 'table'"
                                type="button"
                                >Table</button>
                            <button
                                class="btn btn-default"
                                ng-class="mode == 'tiles' && 'active' || ''"
                                ng-click="mode = 'tiles'"
                                type="button"
                                >Tiles</button>
                        </div>
                        <h2>Books</h2>
                    </div>
                    <table
                        class="table table-hover table-striped"
                        ng-show="mode == 'table'"
                        >
                        <thead>
                            <th class="narrow right">Rank</th>
                            <th>Title</th>
                            <th class="narrow">Author</th>
                            <th class="narrow right">Price ($)</th>
                            <th class="narrow right">Print Length</th>
                            <th class="narrow right">Reviews</th>
                            <th class="narrow right">Review Average</th>
                            <th class="narrow right">Amazon BSR</th>
                            <th class="narrow right">Days in the Top 100</th>
                        </thead>
                        <tbody
                            ng-controller="book"
                            ng-repeat="book in contents.books"
                            >
                            <tr>
                                <td class="narrow right">
                                    [! book.rank|number:0 !]
                                </td>
                                <td>
                                    <a
                                        class="pull-right"
                                        ng-click="status = true"
                                        ng-show="!status"
                                        >Show More</a>
                                    <a
                                        class="pull-right"
                                        ng-click="status = false"
                                        ng-show="status"
                                        >Show Less</a>
                                    <a
                                        href="[! book.url !]"
                                        rel="noreferrer"
                                        target="_blank"
                                        >[! book.title !]</a>
                                </td>
                                <td class="narrow">
                                    [! book.author !]
                                </td>
                                <td class="narrow right">
                                    [! book.price|number:2 !]
                                </td>
                                <td class="narrow right">
                                    [! book.print_length|number:0 !]
                                </td>
                                <td class="narrow right">
                                    [! book.total_number_of_reviews|number:0 !]
                                </td>
                                <td class="narrow right">
                                    [! book.review_average|number:2 !]
                                </td>
                                <td class="narrow right">
                                    <span ng-show="book.amazon_best_sellers_rank['Paid in Kindle Store']">
                                        [! book.amazon_best_sellers_rank['Paid in Kindle Store'] !]
                                    </span>
                                    <span ng-show="!book.amazon_best_sellers_rank['Paid in Kindle Store']">
                                        N/A
                                    </span>
                                </td>
                                <td class="narrow right">
                                    <span ng-show="book.days_in_the_top_100 > 0">
                                        [! book.days_in_the_top_100|number:0 !]
                                    </span>
                                    <span ng-show="book.days_in_the_top_100 == 0">
                                        N/A
                                    </span>
                                </td>
                            </tr>
                            <tr ng-show="status">
                                <td class="details" colspan="9">
                                    <p>
                                        <strong>Publication Date:</strong>
                                        [! book.publication_date !]
                                    </p>
                                    <p><strong>Categories & Ranks:</strong></p>
                                    <ul ng-controller="amazon_best_sellers_rank">
                                        <li
                                            ng-repeat="(key, value) in book.amazon_best_sellers_rank"
                                            ng-show="(key == 'Paid in Kindle Store') || $parent.status"
                                            >
                                            <strong>#[! value !]</strong>
                                            in
                                            [! key !]
                                            <span ng-show="key == 'Paid in Kindle Store'">
                                                <a
                                                    ng-click="$parent.status = true"
                                                    ng-show="!$parent.status"
                                                    >Show More</a>
                                                <a
                                                    ng-click="$parent.status = false"
                                                    ng-show="$parent.status"
                                                    >Show Less</a>
                                            </span>
                                        </li>
                                    </ul>
                                    <p>
                                        <strong>
                                            Estimated Sales Per Day:
                                        </strong>
                                        [! book.estimated_sales_per_day|number:0 !]
                                    </p>
                                    <p>
                                        <strong>Earnings Per Day:</strong>
                                        $[! book.earnings_per_day|number:2 !]
                                    </p>
                                    <p><strong>Appearances:</strong></p>
                                    <ul>
                                        <li ng-repeat="(key, value) in book.appearances">
                                            <strong>
                                                [! value|number:2 !]%
                                            </strong>
                                            in the
                                            [! key !]
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div
                        class="row-fluid"
                        ng-repeat="chunk in contents.chunks"
                        ng-show="mode == 'tiles'"
                        >
                        <div
                            class="span4"
                            ng-repeat="book in chunk"
                            >
                            <div class="media well">
                                <div class="media-body">
                                    <h4 class="media-heading">
                                        [! book.rank !].
                                        <a
                                            href="[! book.url !]"
                                            rel="noreferrer"
                                            target="_blank"
                                            >[! book.title !]</a>
                                    </h4>
                                    <p>
                                        <strong>Author:</strong>
                                        [! book.author !]
                                    </p>
                                    <p>
                                        <strong>Price:</strong>
                                        $[! book.price|number:2 !]
                                    </p>
                                    <p>
                                        <strong>Publication Date:</strong>
                                        [! book.publication_date !]
                                    </p>
                                    <p>
                                        <strong>Print Length:</strong>
                                        [! book.print_length|number:0 !]
                                    </p>
                                    <p>
                                        <strong>Days in the Top 100:</strong>
                                        <span ng-show="book.days_in_the_top_100 > 0">
                                            [! book.days_in_the_top_100|number:0 !]
                                        </span>
                                        <span ng-show="book.days_in_the_top_100 == 0">
                                            N/A
                                        </span>
                                    </p>
                                    <p><strong>Categories & Ranks:</strong></p>
                                    <ul ng-controller="amazon_best_sellers_rank">
                                        <li
                                            ng-repeat="(key, value) in book.amazon_best_sellers_rank"
                                            ng-show="(key == 'Paid in Kindle Store') || $parent.status"
                                            >
                                            <strong>#[! value !]</strong>
                                            in
                                            [! key !]
                                            <span ng-show="key == 'Paid in Kindle Store'">
                                                <a
                                                    ng-click="$parent.status = true"
                                                    ng-show="!$parent.status"
                                                    >Show More</a>
                                                <a
                                                    ng-click="$parent.status = false"
                                                    ng-show="$parent.status"
                                                    >Show Less</a>
                                            </span>
                                        </li>
                                    </ul>
                                    <p>
                                        <strong>
                                            Estimated Sales Per Day:
                                        </strong>
                                        [! book.estimated_sales_per_day|number:0 !]
                                    </p>
                                    <p>
                                        <strong>Earnings Per Day:</strong>
                                        $[! book.earnings_per_day|number:2 !]
                                    </p>
                                    <p>
                                        <strong>Reviews:</strong>
                                        [! book.total_number_of_reviews|number:0 !]
                                    </p>
                                    <p>
                                        <strong>Review Avg:</strong>
                                        [! book.review_average|number:2 !]
                                    </p>
                                    <p><strong>Appearances:</strong></p>
                                    <ul>
                                        <li ng-repeat="(key, value) in book.appearances">
                                            <strong>
                                                [! value|number:2 !]%
                                            </strong>
                                            in the
                                            [! key !]
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div ng-show="contents.categories.length">
                    <hr>
                    <div class="page-header">
                        <h2>Categories</h2>
                    </div>
                    <table class="table table-hover table-striped">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th class="narrow text-right">Frequency</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="category in contents.categories">
                                <td><strong>[! category[0] !]</strong></td>
                                <td class="narrow text-right">
                                    [! category[1]|number:0 !]
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
